{
  "version": 1,
  "defaults": {
    "model": "default-chat",
    "timeout_s": 60,
    "max_attempts": 2,
    "json_only": false,
    "max_total_attempts": 5,
    "retry_on_http": [
      408,
      429,
      500,
      502,
      503,
      504
    ],
    "retry_on_empty": true
  },
  "rules": [
    {
      "name": "plan_web_strict_json",
      "when": {
        "task": "plan_web"
      },
      "set": {
        "model": "default-chat",
        "timeout_s": 90,
        "max_attempts": 3,
        "json_only": true
      }
    },
    {
      "name": "plan_cli_strict_json",
      "when": {
        "task": "plan"
      },
      "set": {
        "model": "default-chat",
        "timeout_s": 90,
        "max_attempts": 3,
        "json_only": true
      }
    },
    {
      "name": "long_text_routing",
      "when": {
        "task": "other",
        "text_min_chars": 1200
      },
      "set": {
        "model": "long-chat",
        "timeout_s": 120,
        "max_attempts": 2
      }
    }
  ],
  "length_thresholds": {
    "long_chars": 1200
  },
  "tasks": {
    "plan": {
      "json_only": true,
      "timeout_s": 60,
      "max_total_attempts": 5,
      "retry_on_http": [
        408,
        429,
        500,
        502,
        503,
        504
      ],
      "retry_on_empty": true,
      "fallback_models": [
        "best-effort-chat",
        "long-chat"
      ]
    },
    "plan_web": {
      "json_only": true,
      "timeout_s": 60,
      "max_total_attempts": 5,
      "retry_on_http": [
        408,
        429,
        500,
        502,
        503,
        504
      ],
      "retry_on_empty": true,
      "fallback_models": [
        "best-effort-chat",
        "long-chat"
      ]
    }
  }
}
